class Highlights{constructor(){this.observerOptions={root:null,threshold:1},this.observer=new IntersectionObserver(this.observerCallback,this.observerOptions),this.scrollContainer=document.querySelector(".lh-highlight-scroll-container"),this.scrollContainer.childNodes.forEach(t=>{Highlights.addBars(t),this.displayPanel(t.querySelector(".lh-story")),this.attachSocialLink(t),this.addAnimation(t),this.addTargetToObserver(t),this.addNodeControls(t)}),this.loader=document.querySelector(".lh-highlight-loader")}static windowSize=window.innerWidth;static animationList=[];static interactionThreshold=200;static currentIndex=0;static eventStartTime;static coordsX;static currentNodeInView;addNodeToList(t){null!=t&&(Highlights.addBars(t),this.displayPanel(t.querySelector(".lh-story")),this.attachSocialLink(t),this.addAnimation(t),this.addTargetToObserver(t),this.addNodeControls(t),this.scrollContainer.append(t))}addNodeControls(t){Highlights.windowSize>1024?(t.addEventListener("mousedown",e=>{Highlights.currentNodeInView.node==t&&Highlights.setEvent(e,Highlights.currentNodeInView.animations)}),t.addEventListener("mouseup",()=>{Highlights.currentNodeInView.node==t&&Highlights.setupContainerControls(Highlights.currentNodeInView.node,Highlights.currentNodeInView.animations,Highlights.currentNodeInView.panels)})):(t.addEventListener("touchstart",e=>{Highlights.currentNodeInView.node==t&&Highlights.setEvent(e.touches[0],Highlights.currentNodeInView.animations)}),t.addEventListener("touchend",()=>{Highlights.currentNodeInView.node==t&&Highlights.setupContainerControls(Highlights.currentNodeInView.node,Highlights.currentNodeInView.animations,Highlights.currentNodeInView.panels)}))}displayPanel(t){t.style.opacity=1,t.style.zIndex=2}hidePanel(t){t.style.opacity=0,t.style.zIndex=0}observerCallback(t){let e=document.querySelector(".lh-highlight-scroll-container"),i=document.querySelector(".lh-highlight-scroll-container").children.length;t.forEach((t,n)=>{let h=Highlights.animationList.find(e=>e.node==t.target);(Highlights.currentIndex=0,h.animations.map((t,e)=>{t.cancel(),t.pause()}),t.isIntersecting)?(i>1&&[...e.children].indexOf(t.target)==i-1&&$("#highlight-next").length>0&&($("#highlight-next")[0].getAttribute("style")||$("#highlight-next")[0].click(),t.target.scrollIntoView()),h.animations.map((t,e)=>{e<1&&t.play(),e<h.animations.length-1&&(t.onfinish=function(){h.animations[e+1].play(),h.panels[e+1].style.zIndex=2,h.panels[e+1].style.opacity=1,Highlights.currentIndex=e+1})}),Highlights.setCurrentNode(h)):(h.panels[Highlights.currentIndex].style.zIndex=2,h.panels[Highlights.currentIndex].style.opacity=1,h.panels[Highlights.currentIndex].position="relative",h.animations.map((t,e)=>{t.cancel(),t.pause(),e>0&&(h.panels[e].style.zIndex=0,h.panels[e].style.opacity=0),t.onfinish=function(){}}),$(".lh-highlight-controls-container").removeClass("lh-active-vertical"),$(".lh-highlight-controls-container").children(".lh-social-icon").css("display","none"),$(".lh-highlight-controls-container").children(".lh-display-icon").css("display","flex"))})}addTargetToObserver(t){this.observer.observe(t)}addAnimation(t){let e=[{width:"0%"},{width:"100%"}],i=t.querySelectorAll(".lh-highlights-progress"),n=t.querySelectorAll(".lh-story"),h={node:t,animations:[],panels:n};i.forEach((t,i)=>{h.animations.push(t.animate(e,{duration:3e3,fill:"forwards"}))}),Highlights.animationList.push(h)}attachSocialLink(t){let e=t.querySelector('[data-social="facebook"]'),i=t.querySelector('[data-social="twitter"]'),n=t.querySelector(".highlight-slug").textContent,h=window.location.origin,s=`https://www.facebook.com/sharer/sharer.php?u=${h}/usapangpera/highlights/${n}`,l=`https://twitter.com/intent/tweet?url=${h}/usapangpera/highlights/${n}`;e.href=s,i.href=l}static setEvent(t,e){let i=t.target.getBoundingClientRect();this.eventStartTime=Date.now(),Highlights.coordsX=t.clientX-i.left,e[Highlights.currentIndex].pause()}static setupContainerControls(t,e,i){let n=Date.now()-this.eventStartTime,h=Math.ceil(.2*t.getBoundingClientRect().width);n<Highlights.interactionThreshold&&(Highlights.coordsX<h?Highlights.currentIndex>0&&(e[Highlights.currentIndex].cancel(),e[Highlights.currentIndex-1].play(),i[Highlights.currentIndex].style.zIndex=0,i[Highlights.currentIndex].style.opacity=0,i[Highlights.currentIndex-1].style.zIndex=2,i[Highlights.currentIndex-1].style.opacity=1,Highlights.currentIndex=Highlights.currentIndex-1):Highlights.currentIndex!=e.length-1&&(e[Highlights.currentIndex].finish(),e[Highlights.currentIndex+1].play(),i[Highlights.currentIndex].style.zIndex=0,i[Highlights.currentIndex].style.opacity=0,i[Highlights.currentIndex+1].style.zIndex=2,i[Highlights.currentIndex+1].style.opacity=1,i[Highlights.currentIndex+1].style.opacity="relative",Highlights.currentIndex=Highlights.currentIndex+1)),e[Highlights.currentIndex].play()}static setCurrentNode(t){Highlights.currentNodeInView=t}static addBars(t){let e=t.querySelector(".lh-stories-bar-wrap"),i;t.querySelectorAll(".lh-story").forEach(t=>{i=document.querySelector(".lh-highlights-bar").cloneNode(!0),e.append(i)})}}let highlights=new Highlights;window.fsAttributes=window.fsAttributes||[],window.fsAttributes.push(["cmsload",t=>{let[e]=t;highlights.loader.querySelectorAll(".lh-highlight-list-item > .lh-story-container").forEach(t=>{highlights.addNodeToList(t)}),e.on("renderitems",t=>{t.map(t=>{highlights.addNodeToList(t.element.querySelector(".lh-story-container"))})})},]);
